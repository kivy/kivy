#:kivy 1.4
#:import KivyLexer kivy.extras.highlight.KivyLexer

# Catalog is the root widget of the app.
<Catalog>:
    language_box: language_box
    current_render: current_render
    name_spinner:  name_spinner
    category_spinner: category_spinner
    auto_reload: chkbx.active
    info_label: info_lbl
    orientation: 'vertical'
    BoxLayout:
        padding: '2sp'
        canvas:
            Color:
                rgba: 1, 1, 1, .6
            Rectangle:
                size: self.size
                pos: self.pos
        size_hint: 1, None
        height: '45sp'

        # This is the 'categories' spinner
        Spinner:
            id:  category_spinner
            size_hint: None, 1
            width: '108sp'
            text: root.category_list[0]
            values: root.category_list
            on_text: root.show_kv(category=self.text)

        Widget:

        Button:
            text: '<'
            size_hint: .1, 1
            on_press:  root.show_kv(prev=True)

        Widget:
            size_hint: .1, 1

        # This is the 'name' spinner
        Spinner:
            id: name_spinner
            size_hint: None, 1
            width: '108sp'
            text: root.infos[0].name
            values: [info.name for info in root.infos]
            on_press: root.show_kv(name=self.text)

        Widget:
            size_hint: .1, 1

        Button:
            size_hint: .1, 1
            text: '>'
            on_press:  root.show_kv(next=True)

        Widget:

        BoxLayout:
            size_hint: None, 1
            width: '150sp'
            Label:
                text: "Auto Reload"
            CheckBox:
                id: chkbx
                active: True
                size_hint_x: 1
                on_press:  root.schedule_reload()

        Button:
            size_hint: None, 1
            width: '108sp'
            text: 'Render Now'
            on_release: root.change_kv(*args)
            background_color: (1, 0, 0, 1) if root.need_reload else (0, 1, 0, 1)

    BoxLayout:
        id: reactive_layout
        orientation: 'vertical' if self.width < self.height else 'horizontal'

        Splitter:
            id: editor_pane
            max_size: (reactive_layout.height if self.vertical else reactive_layout.width) - self.strip_size
            min_size: sp(30) + self.strip_size
            vertical: 1 if reactive_layout.width < reactive_layout.height else 0
            sizable_from: 'bottom' if self.vertical else 'right'
            size_hint: (1, None) if self.vertical else (None, 1)
            size: 400, 400
            on_vertical:
                mid_size = self.max_size/2
                if args[1]: self.height = mid_size
                if not args[1]: self.width = mid_size
            ScrollView:
                id: kr_scroll
                KivyRenderTextInput:
                    catalog: root
                    id: language_box
                    auto_indent: True
                    lexer: KivyLexer()
                    size_hint: 1, None
                    height: max(kr_scroll.height, self.minimum_height)
                    font_name: "data/fonts/DroidSansMono.ttf"
                    valign: "top"
                    text: "This box will display the kivy language for whatever has been selected"
                    on_text: root.schedule_reload()
                    on_cursor: root.schedule_reload()
        Screen:
            id: current_render
            canvas.before:
                Color:
                    rgb: 0, 0, 0
                Rectangle:
                    pos: self.pos
                    size: self.size

    FloatLayout:
        size_hint: 1, None
        height: 0
        TextInput:
            id:info_lbl
            readonly: True
            font_size: '14sp'
            background_color: (0, 0, 0, 1)
            foreground_color: (1, 1, 1, 1)
            opacity:0
            size_hint: 1, None
            text_size: self.size
            height: '150pt'
            top: 0
